from telethon import events
from core.client import client

CATEGORIES = {
    "الاحصائيات": [
        ".احصائياتي — احصائيات حسابك",
        ".معلوماتي — معلومات عامة عن الحساب",
    ],
    "التخزين": [
        ".تفعيل التخزين — إنشاء/تفعيل كروب التخزين",
        ".تعطيل التخزين — تعطيل التخزين",
    ],
    "الردود": [
        ".اضف رد + الكلمة + الرد — إضافة رد تلقائي",
        ".الردود — عرض الردود",
        ".تفعيل هنا — تفعيل الردود في المجموعة",
        ".تعطيل هنا — تعطيل الردود في المجموعة",
    ],
    "AFK والمخصص": [
        ".تشغيل الرد — تفعيل الرد التلقائي",
        ".تعطيل الرد — تعطيل الرد التلقائي",
        ".المخصص تشغيل — تفعيل الردود المخصصة",
        ".رد <النص> (بالرد) — إضافة رد مخصص للكلمة",
        ".حذف رد (بالرد) — حذف الرد المخصص",
        ".كليشة الرد (بالرد) — تعيين رسالة كليشة",
        ".سماح — سماح هذه المحادثة الخاصة",
        ".الغاء السماح — إلغاء السماح",
    ],
    "الملف الشخصي": [
        ".الاسم (الاسم) — تغيير الاسم مع الوقت",
        ".تفعيل الاسم الوقتي — تضمين الوقت بالاسم",
        ".تعطيل الاسم الوقتي — إزالة الوقت من الاسم",
        ".انتحال (بالرد) — نسخ اسم/بايو/صورة شخص",
        ".ارجاع — استرجاع اسم/بايو/صورة المخزنة",
    ],
    "النشر والمؤقتات": [
        ".تكرار <ثواني> <عدد> [نص] — نشر متكرر",
        ".تك <ثواني> <عدد> [نص] — اختصار للتكرار",
        ".نشر <ثواني> <عدد> [نص] — نشر",
        ".ايقاف النشر التلقائي — إيقاف كل النشر",
    ],
    "الحماية والتحذير": [
        ".حماية الخاص — تفعيل/تعطيل فلتر الخاص",
        ".قبول (بالرد) — قبول هذا المستخدم",
        ".الغاء القبول (بالرد) — إزالة القبول",
        ".مسح التحذيرات (بالرد) — مسح تحذيرات شخص",
        ".التحذيرات — عرض تحذيراتك",
        ".تعيين كليشة التحذير (بالرد) — تغيير الكليشة",
        ".عرض كليشة — عرض الكليشة الحالية",
        ".عدد التحذيرات <n> — ضبط الحد",
        ".المحظورين — عرض المحظورين",
        ".مسح المحظورين — مسح المحظورين",
    ],
    "ألعاب": [
        ".سهم [1..6] — لعبة السهم",
        ".نرد [1..6] — لعبة النرد",
        ".سله [1..5] — كرة السلة",
        ".كرة [1..5] — كرة القدم",
        ".حظ [1..64] — القمار/السلات",
        ".gym — حركة نصية",
    ],
    "اختصارات/ميمز": [
        ".اختصار + KEY (بالرد) — حفظ اختصار",
        ".حذف اختصار + KEY — حذف اختصار",
        ".الاختصارات — عرض الاختصارات",
        ".ميمز KEY URL — إضافة بصمة ميمز",
        ".قائمة الميمز — عرض بصمات الميمز",
        "ازالة KEY — حذف بصمة",
        ".ازالة_البصمات — حذف كل البصمات",
    ],
    "أدوات المستخدم": [
        ".قائمه جميع القنوات | القنوات المشرف عليها | قنواتي",
        ".قائمه جميع المجموعات | مجموعات اديرها | كروباتي",
        ".كشف المجموعة [اختياري] — تفاصيل المجموعة/القناة",
    ],
    "ميديا": [
        ".يوتيوب <نص> — بحث يوتيوب",
        ".ملصق (بالرد على صورة) — صنع ملصق",
        ".معلومات الملصق (بالرد) — معلومات الحزمة",
        ".تك <رابط تيك توك> — تنزيل فيديو",
    ],
    "صيد اليوزرات": [
        ".صيد <نمط/نوع> — بدء الصيد وتعيين المتاح",
        ".ايقاف الصيد — إيقاف",
        ".حالة الصيد — عرض الحالة",
    ],
    "مراقبة": [
        ".مراقبة <@user> — إضافة للمراقبة",
        ".ايقاف_المراقبة <@user> — إيقاف",
    ],
    "إدارة": [
        ".حظر / .طرد / .تقييد (بالرد أو تمرير الهدف)",
        ".الغاء الحظر / .الغاء التقييد",
    ],
}

SECTION_ALIASES = {
    "احصائيات": "الاحصائيات",
    "التخزين": "التخزين",
    "ردود": "الردود",
    "afk": "AFK والمخصص",
    "المخصص": "AFK والمخصص",
    "بروفايل": "الملف الشخصي",
    "الاسم": "الملف الشخصي",
    "نشر": "النشر والمؤقتات",
    "تايمر": "النشر والمؤقتات",
    "حماية": "الحماية والتحذير",
    "تحذير": "الحماية والتحذير",
    "العاب": "ألعاب",
    "اختصارات": "اختصارات/ميمز",
    "ميمز": "اختصارات/ميمز",
    "مستخدم": "أدوات المستخدم",
    "ميديا": "ميديا",
    "صيد": "صيد اليوزرات",
    "مراقبة": "مراقبة",
    "ادارة": "إدارة",
}


def build_categories_text():
    lines = ["**قائمة الأوامر — الأقسام المتاحة:**\n"]
    for i, name in enumerate(CATEGORIES.keys(), start=1):
        lines.append(f"{i}. {name}")
    lines.append("\nاستخدم: `.اوامر <القسم>` لعرض أوامر قسم محدد.\nمثال: `.اوامر الحماية والتحذير`")
    return "\n".join(lines)


def build_section_text(section_name):
    cmds = CATEGORIES.get(section_name)
    if not cmds:
        return "⎙ القسم غير معروف. اكتب `.الاوامر` لعرض الأقسام."
    header = f"**أوامر قسم: {section_name}**\n"
    body = "\n".join(f"- {c}" for c in cmds)
    return f"{header}\n{body}"


@client.on(events.NewMessage(from_users='me', pattern=r'^\.الاوامر$'))
async def show_categories(event):
    await event.edit(build_categories_text())


@client.on(events.NewMessage(from_users='me', pattern=r'^\.اوامر (.+)$'))
async def show_section(event):
    name = event.pattern_match.group(1).strip()
    # طبّق الأسماء البديلة
    name = SECTION_ALIASES.get(name, name)
    await event.edit(build_section_text(name))